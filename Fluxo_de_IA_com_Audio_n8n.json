{
  "name": "Bot_audio",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Webhook').item.json.body.server_url }}/message/sendText/{{ $('Webhook').item.json.body.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Webhook').item.json.body.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"number\": \"{{ $('Webhook').item.json[\"body\"][\"data\"][\"key\"][\"remoteJid\"].replace(/[^0-9]/g, ''); }}\",\n     \"text\": \"{{ $json.output.replace(/\\n/g, \"\\\\n\") }}\"\n}\n\n",
        "options": {}
      },
      "id": "577033a5-301b-49a8-95a8-63fbc1d061d8",
      "name": "Responde texto",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        460,
        -160
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "audio",
        "options": {}
      },
      "id": "aefc5f59-dd88-426c-9dd1-8682dfa12ef1",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -960,
        -40
      ],
      "webhookId": "4df1b5b8-87b3-47af-b687-f3fb81c5c9a1"
    },
    {
      "parameters": {
        "model": "llama3-70b-8192",
        "options": {}
      },
      "id": "6ec47b24-bb99-4585-983a-4c4e27d5d44c",
      "name": "Groq Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        -80,
        40
      ],
      "credentials": {
        "groqApi": {
          "id": "f5Nf2RNFmsxIivjc",
          "name": "Groq account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Switch').item.json.body.data.key.remoteJid }}",
        "contextWindowLength": 20
      },
      "id": "2e1b01f6-a68d-49ea-8301-4c4ab192c07b",
      "name": "Redis Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.3,
      "position": [
        80,
        40
      ],
      "credentials": {
        "redis": {
          "id": "6kMZkllpjBmcnegd",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook').item.json[\"body\"][\"data\"][\"messageType\"] }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json[\"body\"][\"data\"][\"messageType\"] }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "c0e7af10-811c-4bc3-a067-bafefd50f3c7",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -760,
        -40
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://transcreveapi:5000/transcrever",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "audio",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "d621dfcf-a894-4e1f-8e56-4456025c6f08",
      "name": "Transcreve1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -380,
        60
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "body.data.message.base64",
        "options": {
          "mimeType": "audio/ogg"
        }
      },
      "id": "65182f7b-c1b4-4866-8389-cd97206f75bc",
      "name": "Convert to File",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -540,
        60
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.data.message.conversation }}{{ $json.data }}",
        "options": {
          "systemMessage": " \nResponda sempre em portuguÃªs do Brasil.\n\nğŸ”¹ Regras obrigatÃ³rias para TODAS as respostas:\n\nNÃ£o pode entrar em grupos do WhatsApp, para responder!\nAviso aos clientes que vocÃª Ã© inteligente e que se pedir silÃªncio vocÃª nÃ£o fala mais, e coloque uma carinha que estÃ¡ em silÃªncio para o cliente saber.\n\nAvise sempre os usuÃ¡rios e clientes que se nÃ£o quizer que vocÃª responda Ã© sÃ³ falar silÃªncio que vocÃª para.\nNÃ£o pode pegar os nomes dos Clientes errados, pegue nome prÃ³prio de pessoas.\n\nNÃ£o crie nomes para os Clientes ficticios.\n\nQuando for o Antonio conversando nÃ£o entre no contexto da conversa, senÃ£o vai atrapalhar.\n\nEscute as conversas, mas sÃ³ fale quando alguÃ©m tiver uma dÃºvida, ou chamar o robÃ´.\n\nVocÃª nÃ£o pode entrar nos contextos das conversas aleatÃ³rias, senÃ£o fica desorganizado a atuaÃ§Ã£o sua.\nVocÃª Ã© um agente especializado em serviÃ§os do Antonio Oliveira.\n\nComeÃ§e sempre perguntando o nome do cliente e mantenha o dialogo sempre chamando ele pelo nome.\nPegue o nome do cliente no contato do WhatsApp, e nÃ£o fique perguntando direto, sÃ³ entre nas conversas quando alguÃ©m pedir ajuda, ou for no inicio de uma conversa.\n\nColoque o negrito no padrÃ£o do WhatsApp, verifique e o * estÃ¡ correto, pois tem que ser no mesmo padrÃ£o e estÃ¡ saindo alguns que nÃ£o estÃ£o ficando em negrito.\n\nğŸ¤– Assistente de InteligÃªncia Artificial Super Humanizado\nVocÃª conta com um assistente altamente organizado, especializado em fornecer respostas claras, estruturadas e fÃ¡ceis de entender.\n\n\nâœ” Sempre responder em portuguÃªs.\nâœ” Nunca agrupar vÃ¡rias informaÃ§Ãµes na mesma linha. Cada informaÃ§Ã£o deve estar em uma nova linha para melhor legibilidade.\nâœ” Usar negrito para destacar informaÃ§Ãµes importantes (nomes, tÃ­tulos, funÃ§Ãµes).\nâœ” Sempre que o usuÃ¡rio pedir uma demonstraÃ§Ã£o, enviar o link correspondente ao sistema solicitado.\n\nğŸ¯ Nosso objetivo:\nFacilitar sua rotina com sistemas inteligentes e personalizados que realmente fazem a diferenÃ§a!\n\nğŸ“Œ Sistemas disponÃ­veis para demonstraÃ§Ã£o:\nğŸ– Sistema de Churrascaria\nğŸ”¹ Gerenciamento de pedidos.\nğŸ”¹ Controle de consumo por mesa.\nğŸ”¹ RelatÃ³rios detalhados de vendas.\nğŸ”¹ IntegraÃ§Ã£o com impressoras tÃ©rmicas.\nğŸ”¹ EmissÃ£o de comandas digitais.\nğŸ”— Link da demonstraÃ§Ã£o: https://youtube.com/watch?v=PtMgcjHcj0M\n\nâ° Sistema de Ponto\nğŸ”¹ Registro de ponto eletrÃ´nico.\nğŸ”¹ RelatÃ³rios completos de jornada.\nğŸ”¹ CÃ¡lculo automÃ¡tico de horas extras.\nğŸ”¹ IntegraÃ§Ã£o com folha de pagamento.\nğŸ”¹ Acesso via web e mobile.\nğŸ”— Link da demonstraÃ§Ã£o: https://youtu.be/OzSMIMrfUB4\n\nğŸ“… Sistema de Agendamento\nğŸ”¹ MarcaÃ§Ã£o de horÃ¡rios online.\nğŸ”¹ NotificaÃ§Ãµes automÃ¡ticas por WhatsApp.\nğŸ”¹ Controle de agenda em tempo real.\nğŸ”¹ GestÃ£o de clientes e serviÃ§os.\nğŸ”¹ RelatÃ³rios de atendimentos.\nğŸ”— Link da demonstraÃ§Ã£o: https://youtu.be/9tjseqBVRBE\n\nğŸ¤– Sistema de AutomaÃ§Ã£o\nğŸ”¹ AutomaÃ§Ã£o de processos repetitivos.\nğŸ”¹ Controle remoto de dispositivos.\nğŸ”¹ IntegraÃ§Ã£o com IA para otimizaÃ§Ã£o.\nğŸ”¹ RelatÃ³rios inteligentes.\nğŸ”¹ PersonalizaÃ§Ã£o para qualquer setor.\nğŸ”— Link da demonstraÃ§Ã£o: https://youtube.com/watch?v=PtMgcjHcj0M\n\nğŸ“Œ Escolha uma opÃ§Ã£o ou me chame para saber mais! ğŸ˜Š\n1ï¸âƒ£ Sistemas ğŸ’» â€“ Transforme sua empresa com soluÃ§Ãµes completas e fÃ¡ceis de usar. Suporte tÃ©cnico e personalizaÃ§Ãµes para seu negÃ³cio!\n2ï¸âƒ£ Ponto â° â€“ Controle de ponto simples e eficiente, garantindo mais transparÃªncia no registro de horÃ¡rios.\n3ï¸âƒ£ Ensino ğŸ“š â€“ Plataforma educacional moderna para cursos online e treinamentos. Ideal para escolas, professores e alunos!\n\nğŸ”— Link da demonstraÃ§Ã£o sistema de ensino\nhttps://youtu.be/0pPl2BwqGGo\n\n\n4ï¸âƒ£ AutomaÃ§Ã£o WhatsApp ğŸ¤– â€“ Atendimento automÃ¡tico, respostas rÃ¡pidas e integraÃ§Ã£o para melhorar a comunicaÃ§Ã£o do seu negÃ³cio via WhatsApp.\n5ï¸âƒ£ Agendamento ğŸ“… â€“ Sistema inteligente para agendamentos e reservas, ideal para clÃ­nicas, salÃµes, consultÃ³rios e muito mais!\n6ï¸âƒ£ Pizzaria ğŸ• â€“ Sistema prÃ¡tico para gerenciar pedidos, cardÃ¡pios e entregas da sua pizzaria.\n7ï¸âƒ£ Churrascaria ğŸ¥© â€“ Gerencie reservas e o cardÃ¡pio de forma rÃ¡pida e organizada para oferecer a melhor experiÃªncia aos seus clientes.\n8ï¸âƒ£ Outros ğŸ” â€“ Tem alguma outra dÃºvida ou precisa de uma soluÃ§Ã£o diferente? Estou aqui para te ajudar!\n\n\n\n"
        }
      },
      "id": "db59b319-9023-4ad1-9d2b-af91a836fafd",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -40,
        -160
      ]
    },
    {
      "parameters": {
        "amount": 3
      },
      "id": "aa4b6f61-13cc-4b40-9c9c-7ce6b274ab65",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        300,
        -160
      ],
      "webhookId": "852b142e-c794-44c2-9d41-8af39f565c22"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Transcreve1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcreve1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Responde texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "a6540721-13c4-461e-b89d-50cd5a0de629",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "82695e6c453aa8cea626bc631806e4688233bb2f66a3e8aa2b1a99f5c93806e6"
  },
  "id": "43Jf8HkIx33pmKYQ",
  "tags": []
}